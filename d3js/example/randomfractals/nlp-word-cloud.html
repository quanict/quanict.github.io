<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NLP Word Cloud</title>
    <link rel="stylesheet" href="../../media/css/com-observablehq.css" type="text/css"/>
    <link rel="stylesheet" href="../../../bootstrap/4.1.3/css/bootstrap.css" type="text/css" />
    <script src="../../5.11.0/d3.min.js"></script>

</head>
<body>
<div class="container">
    <h1>NLP Word Cloud</h1>
    <resource>https://observablehq.com/@randomfractals/nlp-word-cloud</resource>
    <p></p>
    <div class="row">
    </div>
</div>
<script src="../../../jquery/3.2.1/js/jquery-3.2.1.min.js"></script>
<script>
    var words = toWords(doc.nouns().out('topk')) // sort by frequency
        .concat(toWords(doc.verbs().out('topk')))
        .concat(toWords(doc.adverbs().out('topk')))
        .concat(toWords(doc.adjectives().out('topk')))
        .sort((a,b) => b.freq - a.freq),

        doc = nlp(text.value).normalize({
            whitespace: true, // remove hyphens, newlines, and force one space between words
            punctuation: true, // remove commas, semicolons - but keep sentence-ending punctuation
            case: true, // keep only first-word, and 'entity' titlecasing
            numbers: true, // 'one'  →  '1'
            plurals: true, // 'eyes'  →  'eye'
            verbs: true, // 'swtiched' → 'switch'
        }),
        wordColors = d3.scaleSequential(d3.interpolateRainbow),
        rotateWord = function () {
            return ~~(Math.random() * 4) * 45 - 45;
        },
        baseFont = function (d) {
            return fontFamilies[~~(Math.random() * fontFamilies.length)]
        },
        frequencyToSize = function (frequency) {
            return Math.sqrt(frequency);
        },

        fontSize = function(){
            let totalArea = 0;
    let minSize = frequencyToSize(words[words.length-1].freq);
    let maxSize = frequencyToSize(words[0].freq);
    for (let w of words) {
        let size = frequencyToSize(w.freq);
        let fontSize = cloudConfig.minFontSize +
            (cloudConfig.maxFontSize - cloudConfig.minFontSize) * ((size-minSize) / (maxSize-minSize));
        totalArea += (w.text.length * 0.6 + cloudConfig.padding * 2) * fontSize * (fontSize + cloudConfig.padding * 2);
    }
    let s = Math.sqrt(width * cloudConfig.height/totalArea);
    //mutable cloudScale = s;
    return function (w) {
        return s * (cloudConfig.minFontSize +
            (cloudConfig.maxFontSize - cloudConfig.minFontSize) * ((frequencyToSize(w.freq) - minSize) / (maxSize - minSize))
        );
    }
    }
</script>
</body>
</html>